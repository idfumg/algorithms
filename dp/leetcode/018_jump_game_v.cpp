#include "../../template.hpp"

// vvi MakeGraph(const vi& arr, const int d) {
//     const int n = arr.size();
//     vvi graph(n);
//     for (int i = 0; i < n; ++i) {
//         graph[i].push_back(i);
//         for (int j = 1; j <= d and i + j < n; ++j) {
//             if (arr[i] <= arr[i + j]) break;
//             graph[i].push_back(i + j);
//         }
//         for (int j = 1; j <= d and i - j >= 0; ++j) {
//             if (arr[i] <= arr[i - j]) break;
//             graph[i].push_back(i - j);
//         }
//     }
//     return graph;
// }

int dfs(const vvi& graph, vi& dp, const int at) {
    dp[at] = 1;
    for (int adj : graph[at]) {
        if (dp[adj] != -1) dp[at] = max(dp[at], dp[adj] + 1);
        else dp[at] = max(dp[at], dfs(graph, dp, adj) + 1);
    }
    return dp[at];
}

vvi MakeGraph(const vi& arr, const int d) {
    const int n = arr.size();
    vvi graph(n);
    stack<int> st;
    for (int i = 0; i < n; ++i) {
        while (not st.empty() and arr[st.top()] < arr[i]) {
            if (abs(i - st.top()) <= d) graph[i].push_back(st.top());
            st.pop();
        }
        st.push(i);
    }
    while (not st.empty()) st.pop();
    for (int i = n - 1; i >= 0; --i) {
        while (not st.empty() and arr[st.top()] < arr[i]) {
            if (abs(i - st.top()) <= d) graph[i].push_back(st.top());
            st.pop();
        }
        st.push(i);
    }
    return graph;
}

int tab(const vi& arr, const int d) {
    const int n = arr.size();
    vvi graph = MakeGraph(arr, d);
    vi dp(n, -1);

    int count = 0;
    for (int i = 0; i < n; ++i) {
        if (dp[i] == -1) {
            count = max(count, dfs(graph, dp, i));
        }
    }
    return count;
}

int main() { TimeMeasure _; __x();
    cout << tab({6,4,14,6,8,13,9,7,10,6,12}, 2) << endl; // 4
    cout << tab({3,3,3,3,3}, 3) << endl; // 1
    cout << tab({7,6,5,4,3,2,1}, 1) << endl; // 7
    cout << tab({7,1,7,1,7,1}, 2) << endl; // 2
    cout << tab({66}, 1) << endl; // 1
    cout << tab({28,41,39,17,79,53,39,11,96,43,45,93,94,2,78,1,26,32,48,90,62,5,15,48,33,38,13,54,95,4,94,29,17,8,94,83,87,63,71,64,55,89,78,26,79,97,87,99,82,82,52,48,93,100,76,62,99,27,20,92,22,6,61,38,62,57,27,3,14,55,11,96,91,92,71,69,70,79,36,85,74,62,90,38,98,21,77,54,83,92,65,78,14,97,80,5,76,24,33,75,67,57,39,73,39,50,9,2,55,87,5,30,40,39,87,78,86,72,98,60,73,2,37,31,77,93,76,45,13,1,54,94,30,2,72,11,85,97,94,73,61,32,80,6,96,92,67,12,35,8,21,5,55,68,73,33,25,99,41,60,11,52,89,93,37,16,82,22,27,85,70,87,45,58,12,30,11,55,68,26,88,22,59,52,42,38,37,98,10,97,40,71,38,39,51,3,19,16,98,53,2,79,57,51,65,80,35,58,32,85,15,40,37,18,11,37,98,37,6,97,47,45,2,83,1,19,81,76,58,15,91,27,29,97,27,92,98,24,73,52,32,38,1,98,72,3,25,21,54,9,65,23,34,24,40,67,34,90,99,31,8,55,51,9,25,15,56,71,61,80,30,61,64,61,88,14,45,72,33,60,83,22,61,89,86,27,95,54,39,21,83,58,14,48,92,56,100,51,88,72,36,32,99,40,17,46,34,84,57,53,72,75,94,67,39,95,64,20,66,97,41,32,49,5,44,74,15,24,26,55,12,33,66,93,1,25,49,23,67,40,75,18,67,84,84,95,72,99,12,45,65,36,81,88,28,44,37,60,87,56,39,79,9,58,66,87,26,22,1,30,55,96,54,59,92,29,28,26,30,67,2,100,93,60,43,87,51,12,43,75,74,39,3,55,1,26,18,63,1,18,82,46,88,98,18,49,81,34,70,2,69,95,96,67,11,71,91,71,3,9,6,36,98,93,64,33,46,57,13,74,40,93,69,25,93,7,61,80,99,26,91,79,68,43,20,25,53,48,57,61,98,3,88,70,96,20,72,45,92,70,7,74,27,34,8,42,23,90,88,80,92,14,43,61,77,21,57,62,40,46,54,33,20,59,1,2,68,58,55,32,71,19,69,59,77,46,65,53,73,42,83,85,16,37,66,65,97,87,55,81,17,98,24,85,42,78,63,92,37,34,95,19,69,6,91,46,14,41,54,83,16,14,44,4,44,18,68,17,15,93,16,4,37,48,85,10,90,39,25,56,66,8,100,43,6,10,67,62,44,23,19,93,23,14,49,39,80,80,27,79,48,13,11,36,28,75,33,37,45,7,88,92,73,34,84,92,72,11,56,74,38,78,7,14,15,50,34,53,1,51,85,16,24,93,61,34,22,97,17,32,90,27,46,99,6,69,29,23,42,13,67,86,40}, 407) << endl; // 16
    cout << tab({28397,53679,31173,57355,32616,17543,52551,99187,14558,78863,10570,65956,85124,97975,29272,75169,98355,11889,89867,85451,68898,93811,86914,28670,41112,4537,75733,38354,94761,52541,97436,634,13990,80635,64857,93905,52406,86691,40556,77352,94649,33543,99978,72988,93711,7388,31809,6993,70861,12036,84514,20273,50527,77827,71829,8835,71800,79345,76286,33853,15090,6991,53470,36662,81265,35184,34346,95655,64247,19486,64907,15270,59550,92940,59089,61305,85650,48740,34173,59021,51463,44778,14669,28431,3239,24757,62767,86435,13076,45038,55999,17550,6153,3221,64390,5237,27333,61274,43172,94824,31065,72985,50181,18327,8850,75650,70611,30007,18053,95942,32821,70346,4582,75357,96027,70184,60749,50124,99754,10909,1417,18371,58129,90992,19446,88975,48567,3829,95111,66541,45624,87271,66765,50989,52448,90865,77431,39832,17252,14621,90919,47212,63495,4551,99964,51445,84887,93057,36006,30695,234,98362,79111,82117,3349,69988,33043,47429,91927,31607,30049,88701,99938,65325,75625,69608,76426,94642,66545,99297,13515,37061,35622,17146,68793,65265,27068,59193,49174,12138,87378,88712,77034,78190,55634,37735,27114,76230,4342,62059,9025,97155,76700,41073,98865,12761,96269,7964,64980,78302,3828,51134,88645,23797,25490,53524,84892,31888,88921,34163,53356,19936,22750,73410,35203,48283,27322,68189,21721,43836,43795,62162,79216,54128,26418,1544,65455,15772,42655,74084,71449,67277,30277,60069,69639,82025,88739,1690,14444,15930,72051,8578,31580,98382,2615,64531,85086,7008,17693,65443,44433,78635,27134,43079,32607,16979,2936,13426,60758,39959,1466,70799,89962,79243,79998,30580,20463,21176,4072,16718,46671,71594,51139,67188,54104,13050,44952,20555,58509,19139,32651,65591,86167,91541,27367,84180,62474,66028,18366,92268,56084,49764,86352,69843,80716,99064,51822,11230,15915,25018,44122,70028,89239,82538,97201,57250,70579,68668,21353,8459,87681,77136,43703,7918,20392,39246,49331,90841,32771,96728,59884,25770,95153,18497,48079,35962,52524,5517,2586,81839,42877,16119,85949,52621,56423,36981,13542,4810,88644,78934,91375,41325,2100,24135,13993,94877,9391,63118,3019,4657,23759,23279,50931,15657,21685,88127,66156,66499,32421,13243,77131,78937,70822,6691,69562,67628,81553,22852,86660,57758,8591,48776,98393,20517,62212,52550,65551,17393,52255,76631,68694,62198,31552,31169,44600,45899,50553,22066,32915,6688,29582,84751,2897,96924,59848,83793,16986,5186,18492,17620,79784,6521,44467,79880,44469,97543,85175,28294,92185,29812,14931,58600,15784,89590,79853,26903,7846,80933,55254,82723,85091,41134,37232,24316,4600,23741,84996,81256,99081,41416,28710,71991,64229,92866,37696,36876,27660,75657,8042,37952,5971,22023,81139,69865,10633,72424,59346,77428,41938,84244,54860,83289,13559,82365,46142,55166,80937,87768,46279,69507,25511,67545,37831,11637,46542,5558,1061,63452,36549,62984,80468,68283,28494,42427,72961,14143,38510,54487,11312,86274,14316,8551,63960,74604,3071,9952,92953,412,73558,28468,45552,57853,51447,78073,36387,54436,78215,9891,84838,93389,41014,60371,77799,32959,61967,42239,46065,24245,81726,17402,40008,25494,83304,76481,7270,16508,43471,99802,65961,22943,38151,19542,52426,6011,36824,52933,1508,36937,83620,73823,23546,90651,62060,48589,82390,86443,64944,84505,67272,73326,5549,4775,21666,81277,83474,83236,64532,63256,49198,45026,84452,64842,12849,61909,88756,64543,38527,61267,10055,28324,49281,59069,5688,37774,89045,4555,21823,61780,22588,74978,55347,64689,5633,28860,58575,3476,43131,47708,50600,78306,12881,37018,41764,53657,6911,98836,89353,66427,63304,98473,97757,51309,10252,97118,40627,75229,38891,31501,327,64976,57053,9498,97517,29707,68172,88142,14330}, 283) << endl; // 20
}
