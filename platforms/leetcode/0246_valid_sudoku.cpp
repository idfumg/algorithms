#include "../../template.hpp"

int sol_rows(const vvc& board, int ix, int jx, int m, int n, bool x) {
    array<int, 10> memo2{};
    for (int i = ix; i < m; ++i) {
        array<int, 10> memo{};
        for (int j = jx; j < n; ++j) {
            if (board[i][j] == '.') {
                continue;
            }
            if (x) {
                if (memo2[board[i][j] - '0'] == 1) {
                    return 0;
                }
                memo2[board[i][j] - '0'] = 1;
            }
            else {
                if (memo[board[i][j] - '0'] == 1) {
                    return 0;
                }
                memo[board[i][j] - '0'] = 1;
            }
        }
    }
    return 1;
}

int sol_cols(const vvc& board, int ix, int jx, int m, int n, bool x) {
    array<int, 10> memo2{};
    for (int j = jx; j < n; ++j) {
        array<int, 10> memo{};
        for (int i = ix; i < m; ++i) {
            if (board[i][j] == '.') {
                continue;
            }
            if (x) {
                if (memo2[board[i][j] - '0'] == 1) {
                    return 0;
                }
                memo2[board[i][j] - '0'] = 1;
            }
            else {
                if (memo[board[i][j] - '0'] == 1) {
                    return 0;
                }
                memo[board[i][j] - '0'] = 1;
            }
        }
    }
    return 1;
}

int sol(const vvc& board) {
    const int m = board.size();
    const int n = board[0].size();

    if (not sol_rows(board, 0, 0, m, n, 0)) return 0;
    if (not sol_cols(board, 0, 0, m, n, 0)) return 0;

    for (int i = 0; i < m; i += 3) {
        for (int j = 0; j < n; j += 3) {
            if (not sol_rows(board, i, j, i + 3, j + 3, 1)) return 0;
        }
    }
    return 1;
}

int main() { TimeMeasure _; //__x();
    const vvc board1 =
        {{'5','3','.','.','7','.','.','.','.'},
         {'6','.','.','1','9','5','.','.','.'},
         {'.','9','8','.','.','.','.','6','.'},
         {'8','.','.','.','6','.','.','.','3'},
         {'4','.','.','8','.','3','.','.','1'},
         {'7','.','.','.','2','.','.','.','6'},
         {'.','6','.','.','.','.','2','8','.'},
         {'.','.','.','4','1','9','.','.','5'},
         {'.','.','.','.','8','.','.','7','9'}};

    const vvc board2 =
        {{'8','3','.','.','7','.','.','.','.'},
         {'6','.','.','1','9','5','.','.','.'},
         {'.','9','8','.','.','.','.','6','.'},
         {'8','.','.','.','6','.','.','.','3'},
         {'4','.','.','8','.','3','.','.','1'},
         {'7','.','.','.','2','.','.','.','6'},
         {'.','6','.','.','.','.','2','8','.'},
         {'.','.','.','4','1','9','.','.','5'},
         {'.','.','.','.','8','.','.','7','9'}};

    const vvc board3 =
        {{'.','.','4','.','.','.','6','3','.'},
         {'.','.','.','.','.','.','.','.','.'},
         {'5','.','.','.','.','.','.','9','.'},
         {'.','.','.','5','6','.','.','.','.'},
         {'4','.','3','.','.','.','.','.','1'},
         {'.','.','.','7','.','.','.','.','.'},
         {'.','.','.','5','.','.','.','.','.'},
         {'.','.','.','.','.','.','.','.','.'},
         {'.','.','.','.','.','.','.','.','.'}};

    const vvc board4 =
        {{'.','.','.','.','5','.','.','1','.'},
         {'.','4','.','3','.','.','.','.','.'},
         {'.','.','.','.','.','3','.','.','1'},
         {'8','.','.','.','.','.','.','2','.'},
         {'.','.','2','.','7','.','.','.','.'},
         {'.','1','5','.','.','.','.','.','.'},
         {'.','.','.','.','.','2','.','.','.'},
         {'.','2','.','9','.','.','.','.','.'},
         {'.','.','4','.','.','.','.','.','.'}};

    cout << sol(board1) << endl; // 1
    cout << sol(board2) << endl; // 0
    cout << sol(board3) << endl; // 0
    cout << sol(board4) << endl; // 0
}
