#include "../../template.hpp"

ll rec(const vi& arr, vvvll& dp, const int n, const int mini, const int maxi) {
    if (n == 0) {
        if (not mini or not maxi) return 0;
        return dp[n][mini][maxi] = arr[maxi - 1] - arr[mini - 1];
    }

    if (mini and maxi and dp[n][mini][maxi] != -1) {
        return dp[n][mini][maxi];
    }

    const auto a = rec(arr, dp, n - 1, mini, maxi) % MOD;
    const int min_idx = not mini or arr[mini - 1] > arr[n - 1] ? n : mini;
    const int max_idx = not maxi or arr[maxi - 1] < arr[n - 1] ? n : maxi;
    const int b = rec(arr, dp, n - 1, min_idx, max_idx) % MOD;

    if (mini and maxi) return dp[n][mini][maxi] = (a + b) % MOD;
    return (a + b) % MOD;
}

int rec(const vi& arr) {
    const int n = arr.size();
    vvvll dp(n + 1, vvll(n + 1, vll(n + 1, -1)));
    return rec(arr, dp, n, 0, 0);
}

int tab(const vi& arr) {
    const int n = arr.size();
    vvvll dp(2, vvll(n + 1, vll(n + 1)));
    int idx = 0;
    for (int i = 0; i <= n; ++i) {
        idx = i & 1;
        for (int j = 0; j <= n; ++j) {
            for (int k = 0; k <= n; ++k) {
                if (k > 0 and j > 0 and arr[k - 1] < arr[j - 1]) {
                    continue;
                }
                else if (i == 0) {
                    dp[idx][j][k] = k > 0 and j > 0 ? arr[k - 1] - arr[j - 1] : 0;
                }
                else {
                    const auto a = dp[1 - idx][j][k];
                    const int min_idx = j == 0 or arr[j - 1] > arr[i - 1] ? i : j;
                    const int max_idx = k == 0 or arr[k - 1] < arr[i - 1] ? i : k;
                    const int b = dp[1 - idx][min_idx][max_idx];

                    dp[idx][j][k] = (a + b) % MOD;
                }
            }
        }
    }
    return dp[idx][0][0];
}

ll tab2(vi arr) { // the first and the last elements combined
    const int n = arr.size();
    sort(arr.begin(), arr.end());
    ll ans = 0;
    for (ll i = 0, c = 1; i < n; ++i, c = c * 2 % MOD) {
        ans = (ans + arr[i] * c - arr[n - i - 1] * c) % MOD;
    }
    return (ans + MOD) % MOD;
}

ll tab3(vi arr) { // work with each element separately
    const int n = arr.size();
    sort(arr.begin(), arr.end());
    vll pow2(n + 1);
    pow2[0] = 1;
    for (int i = 1; i < n; ++i) {
        pow2[i] = (2 * pow2[i - 1]) % MOD;
    }
    ll ans = 0;
    for (ll i = 0; i < n; ++i) {
        ans = (ans + (pow2[i] - pow2[n - i - 1]) * arr[i]) % MOD;
    }
    return (ans + MOD) % MOD;
}

int main() { TimeMeasure _; __x();
    cout << rec({2,1,3}) << endl; // 6
    cout << rec({5,69,89,92,31,16,25,45,63,40,16,56,24,40,75,82,40,12,50,62,92,44,67,38,92,22,91,24,26,21,100,42,23,56,64,43,95,76,84,79,89,4,16,94,16,77,92,9,30,13}) << endl; // 857876214
    cout << rec({44,27,23,54,32,57,60,9,69,14,28,86,15,92,47,63,12,99,54,6,16,52,28,86,38,73,16,52,37,30,84,81,46,97,84,17,21,14,52,19,74,20,20,56,89,7,34,21,75,6}) << endl; // 119807443
    cout << rec({372,92,162,65,3,183,295,249,387,384,394,211,333,393,59,327,88,96,172,30,45,167,384,78,35,33,180,241,227,66,107,214,257,332,378,119,167,173,108,57,20,208,303,166,83,32,110,14,155,104,195,72,126,204,252,352,376,185,109,163,66,183,117,371,75,156,140,400,18,116,324,36,150,86,39,214,121,233,312,165,308,123,199,68,336,238,211,162,357,19,338,211,353,248,110,7,11,124,315,190,303,37,326,342,304,22,220,399,308,258,142,281,399,235,190,142,278,235,370,237,390,59,126,122,49,106,53,30,67,13,304,93,186,156,322,103,22,280,292,30,142,282,74,264,242,342,251,386,128,57,142,271,274,125,209,331,138,399,162,176,30,112,304,154,360,146,137,44,393,190,196,253,295,22,213,47,395,134,185,310,144,204,104,171,330,38,271,125,191,285,213,255,255,174,247,307,237,397,335,60}) << endl; // 957015344
    //cout << rec({722,396,948,994,586,282,935,43,168,778,247,467,645,528,167,605,789,301,570,991,631,292,902,115,621,500,416,340,194,428,381,826,79,339,180,905,134,778,144,732,810,777,666,349,390,689,567,833,669,299,476,591,18,12,709,59,450,263,6,547,718,875,806,368,435,79,882,302,352,145,334,702,304,866,230,406,579,878,747,440,457,374,5,725,71,287,64,750,388,272,56,174,954,215,274,92,752,888,987,825,196,911,431,619,417,639,882,185,487,882,306,588,189,551,48,444,425,130,103,840,958,605,154,954,239,163,182,545,162,505,701,137,598,781,575,53,286,2,994,407,533,572,880,105,492,622,330,736,536,623,866,9,308,229,455,925,652,569,502,165,968,376,623,718,119,32,795,958,269,701,527,164,210,936,694,287,964,89,119,30,903,910,682,828,606,474,865,128,661,649,851,612,164,364,655,49,899,909,214,26,379,575,609,450,691,923,979,839,629,903,412,616,266,102,113,651,591,220,519,506,665,394,509,157,924,705,960,144,891,264,333,331,813,741,112,587,862,579,641,437,429,582,618,553,367,721,759,110,834,962,824,344,335,529,489,834,1,972,885,473,639,549,902,275,738,898,334,258,727,313,586,537,98,357,759,731,92,526,145,892,69,694,90,115,92,78,596,868,225,611,722,303,382,720,982,706,395,414,44,584,744,493,336,693,323,684,312,703,357,861,60,5,782,29,871,367,419,782,331,870,78,808,957,719,501,913,782,947,976,176,846,214,994,152,70,873,131,186,557,182,602,325,303,72,146,119,193,518,30,982,879,679,191,498,950,994,955,773,943,900,885,701,767,894,447,717,324,328,603,435,72,227,918,636,968,870,954,119,274,52,719,101,328,312,897,669,360,724,116,507,639,63,252,2,934,595,965,371,305,90,4,469,713,941,710,329,27,169,23,572,612,377,538,348,458,32,737,907,485,697,973,719,736,194,148,863,353,960,448,512,926,49,986,995,411,219,417,784,863,296,545,718,545,584,24,28,420,698,486,264,296,973,592,329,31,576,52,709,556,175,216,246,681,304,842,649,72,457,762,127,176,789,655,667,119,165,713,468,738,570,991,699,849,766,876,895,773,574,642,754,716,419,831,427,592,20,403,638,77,72}) << endl; // 367868228
    cout << endl;
    cout << tab({2,1,3}) << endl; // 6
    cout << tab({5,69,89,92,31,16,25,45,63,40,16,56,24,40,75,82,40,12,50,62,92,44,67,38,92,22,91,24,26,21,100,42,23,56,64,43,95,76,84,79,89,4,16,94,16,77,92,9,30,13}) << endl; // 857876214
    cout << tab({44,27,23,54,32,57,60,9,69,14,28,86,15,92,47,63,12,99,54,6,16,52,28,86,38,73,16,52,37,30,84,81,46,97,84,17,21,14,52,19,74,20,20,56,89,7,34,21,75,6}) << endl; // 119807443
    cout << tab({372,92,162,65,3,183,295,249,387,384,394,211,333,393,59,327,88,96,172,30,45,167,384,78,35,33,180,241,227,66,107,214,257,332,378,119,167,173,108,57,20,208,303,166,83,32,110,14,155,104,195,72,126,204,252,352,376,185,109,163,66,183,117,371,75,156,140,400,18,116,324,36,150,86,39,214,121,233,312,165,308,123,199,68,336,238,211,162,357,19,338,211,353,248,110,7,11,124,315,190,303,37,326,342,304,22,220,399,308,258,142,281,399,235,190,142,278,235,370,237,390,59,126,122,49,106,53,30,67,13,304,93,186,156,322,103,22,280,292,30,142,282,74,264,242,342,251,386,128,57,142,271,274,125,209,331,138,399,162,176,30,112,304,154,360,146,137,44,393,190,196,253,295,22,213,47,395,134,185,310,144,204,104,171,330,38,271,125,191,285,213,255,255,174,247,307,237,397,335,60}) << endl; // 957015344
    //cout << tab({722,396,948,994,586,282,935,43,168,778,247,467,645,528,167,605,789,301,570,991,631,292,902,115,621,500,416,340,194,428,381,826,79,339,180,905,134,778,144,732,810,777,666,349,390,689,567,833,669,299,476,591,18,12,709,59,450,263,6,547,718,875,806,368,435,79,882,302,352,145,334,702,304,866,230,406,579,878,747,440,457,374,5,725,71,287,64,750,388,272,56,174,954,215,274,92,752,888,987,825,196,911,431,619,417,639,882,185,487,882,306,588,189,551,48,444,425,130,103,840,958,605,154,954,239,163,182,545,162,505,701,137,598,781,575,53,286,2,994,407,533,572,880,105,492,622,330,736,536,623,866,9,308,229,455,925,652,569,502,165,968,376,623,718,119,32,795,958,269,701,527,164,210,936,694,287,964,89,119,30,903,910,682,828,606,474,865,128,661,649,851,612,164,364,655,49,899,909,214,26,379,575,609,450,691,923,979,839,629,903,412,616,266,102,113,651,591,220,519,506,665,394,509,157,924,705,960,144,891,264,333,331,813,741,112,587,862,579,641,437,429,582,618,553,367,721,759,110,834,962,824,344,335,529,489,834,1,972,885,473,639,549,902,275,738,898,334,258,727,313,586,537,98,357,759,731,92,526,145,892,69,694,90,115,92,78,596,868,225,611,722,303,382,720,982,706,395,414,44,584,744,493,336,693,323,684,312,703,357,861,60,5,782,29,871,367,419,782,331,870,78,808,957,719,501,913,782,947,976,176,846,214,994,152,70,873,131,186,557,182,602,325,303,72,146,119,193,518,30,982,879,679,191,498,950,994,955,773,943,900,885,701,767,894,447,717,324,328,603,435,72,227,918,636,968,870,954,119,274,52,719,101,328,312,897,669,360,724,116,507,639,63,252,2,934,595,965,371,305,90,4,469,713,941,710,329,27,169,23,572,612,377,538,348,458,32,737,907,485,697,973,719,736,194,148,863,353,960,448,512,926,49,986,995,411,219,417,784,863,296,545,718,545,584,24,28,420,698,486,264,296,973,592,329,31,576,52,709,556,175,216,246,681,304,842,649,72,457,762,127,176,789,655,667,119,165,713,468,738,570,991,699,849,766,876,895,773,574,642,754,716,419,831,427,592,20,403,638,77,72}) << endl; // 367868228
    cout << endl;
    cout << tab2({2,1,3}) << endl; // 6
    cout << tab2({5,69,89,92,31,16,25,45,63,40,16,56,24,40,75,82,40,12,50,62,92,44,67,38,92,22,91,24,26,21,100,42,23,56,64,43,95,76,84,79,89,4,16,94,16,77,92,9,30,13}) << endl; // 857876214
    cout << tab2({44,27,23,54,32,57,60,9,69,14,28,86,15,92,47,63,12,99,54,6,16,52,28,86,38,73,16,52,37,30,84,81,46,97,84,17,21,14,52,19,74,20,20,56,89,7,34,21,75,6}) << endl; // 119807443
    cout << tab2({372,92,162,65,3,183,295,249,387,384,394,211,333,393,59,327,88,96,172,30,45,167,384,78,35,33,180,241,227,66,107,214,257,332,378,119,167,173,108,57,20,208,303,166,83,32,110,14,155,104,195,72,126,204,252,352,376,185,109,163,66,183,117,371,75,156,140,400,18,116,324,36,150,86,39,214,121,233,312,165,308,123,199,68,336,238,211,162,357,19,338,211,353,248,110,7,11,124,315,190,303,37,326,342,304,22,220,399,308,258,142,281,399,235,190,142,278,235,370,237,390,59,126,122,49,106,53,30,67,13,304,93,186,156,322,103,22,280,292,30,142,282,74,264,242,342,251,386,128,57,142,271,274,125,209,331,138,399,162,176,30,112,304,154,360,146,137,44,393,190,196,253,295,22,213,47,395,134,185,310,144,204,104,171,330,38,271,125,191,285,213,255,255,174,247,307,237,397,335,60}) << endl; // 957015344
    cout << tab2({722,396,948,994,586,282,935,43,168,778,247,467,645,528,167,605,789,301,570,991,631,292,902,115,621,500,416,340,194,428,381,826,79,339,180,905,134,778,144,732,810,777,666,349,390,689,567,833,669,299,476,591,18,12,709,59,450,263,6,547,718,875,806,368,435,79,882,302,352,145,334,702,304,866,230,406,579,878,747,440,457,374,5,725,71,287,64,750,388,272,56,174,954,215,274,92,752,888,987,825,196,911,431,619,417,639,882,185,487,882,306,588,189,551,48,444,425,130,103,840,958,605,154,954,239,163,182,545,162,505,701,137,598,781,575,53,286,2,994,407,533,572,880,105,492,622,330,736,536,623,866,9,308,229,455,925,652,569,502,165,968,376,623,718,119,32,795,958,269,701,527,164,210,936,694,287,964,89,119,30,903,910,682,828,606,474,865,128,661,649,851,612,164,364,655,49,899,909,214,26,379,575,609,450,691,923,979,839,629,903,412,616,266,102,113,651,591,220,519,506,665,394,509,157,924,705,960,144,891,264,333,331,813,741,112,587,862,579,641,437,429,582,618,553,367,721,759,110,834,962,824,344,335,529,489,834,1,972,885,473,639,549,902,275,738,898,334,258,727,313,586,537,98,357,759,731,92,526,145,892,69,694,90,115,92,78,596,868,225,611,722,303,382,720,982,706,395,414,44,584,744,493,336,693,323,684,312,703,357,861,60,5,782,29,871,367,419,782,331,870,78,808,957,719,501,913,782,947,976,176,846,214,994,152,70,873,131,186,557,182,602,325,303,72,146,119,193,518,30,982,879,679,191,498,950,994,955,773,943,900,885,701,767,894,447,717,324,328,603,435,72,227,918,636,968,870,954,119,274,52,719,101,328,312,897,669,360,724,116,507,639,63,252,2,934,595,965,371,305,90,4,469,713,941,710,329,27,169,23,572,612,377,538,348,458,32,737,907,485,697,973,719,736,194,148,863,353,960,448,512,926,49,986,995,411,219,417,784,863,296,545,718,545,584,24,28,420,698,486,264,296,973,592,329,31,576,52,709,556,175,216,246,681,304,842,649,72,457,762,127,176,789,655,667,119,165,713,468,738,570,991,699,849,766,876,895,773,574,642,754,716,419,831,427,592,20,403,638,77,72}) << endl; // 367868228
    cout << endl;
    cout << endl;
    cout << tab3({2,1,3}) << endl; // 6
    cout << tab3({5,69,89,92,31,16,25,45,63,40,16,56,24,40,75,82,40,12,50,62,92,44,67,38,92,22,91,24,26,21,100,42,23,56,64,43,95,76,84,79,89,4,16,94,16,77,92,9,30,13}) << endl; // 857876214
    cout << tab3({44,27,23,54,32,57,60,9,69,14,28,86,15,92,47,63,12,99,54,6,16,52,28,86,38,73,16,52,37,30,84,81,46,97,84,17,21,14,52,19,74,20,20,56,89,7,34,21,75,6}) << endl; // 119807443
    cout << tab3({372,92,162,65,3,183,295,249,387,384,394,211,333,393,59,327,88,96,172,30,45,167,384,78,35,33,180,241,227,66,107,214,257,332,378,119,167,173,108,57,20,208,303,166,83,32,110,14,155,104,195,72,126,204,252,352,376,185,109,163,66,183,117,371,75,156,140,400,18,116,324,36,150,86,39,214,121,233,312,165,308,123,199,68,336,238,211,162,357,19,338,211,353,248,110,7,11,124,315,190,303,37,326,342,304,22,220,399,308,258,142,281,399,235,190,142,278,235,370,237,390,59,126,122,49,106,53,30,67,13,304,93,186,156,322,103,22,280,292,30,142,282,74,264,242,342,251,386,128,57,142,271,274,125,209,331,138,399,162,176,30,112,304,154,360,146,137,44,393,190,196,253,295,22,213,47,395,134,185,310,144,204,104,171,330,38,271,125,191,285,213,255,255,174,247,307,237,397,335,60}) << endl; // 957015344
    cout << tab3({722,396,948,994,586,282,935,43,168,778,247,467,645,528,167,605,789,301,570,991,631,292,902,115,621,500,416,340,194,428,381,826,79,339,180,905,134,778,144,732,810,777,666,349,390,689,567,833,669,299,476,591,18,12,709,59,450,263,6,547,718,875,806,368,435,79,882,302,352,145,334,702,304,866,230,406,579,878,747,440,457,374,5,725,71,287,64,750,388,272,56,174,954,215,274,92,752,888,987,825,196,911,431,619,417,639,882,185,487,882,306,588,189,551,48,444,425,130,103,840,958,605,154,954,239,163,182,545,162,505,701,137,598,781,575,53,286,2,994,407,533,572,880,105,492,622,330,736,536,623,866,9,308,229,455,925,652,569,502,165,968,376,623,718,119,32,795,958,269,701,527,164,210,936,694,287,964,89,119,30,903,910,682,828,606,474,865,128,661,649,851,612,164,364,655,49,899,909,214,26,379,575,609,450,691,923,979,839,629,903,412,616,266,102,113,651,591,220,519,506,665,394,509,157,924,705,960,144,891,264,333,331,813,741,112,587,862,579,641,437,429,582,618,553,367,721,759,110,834,962,824,344,335,529,489,834,1,972,885,473,639,549,902,275,738,898,334,258,727,313,586,537,98,357,759,731,92,526,145,892,69,694,90,115,92,78,596,868,225,611,722,303,382,720,982,706,395,414,44,584,744,493,336,693,323,684,312,703,357,861,60,5,782,29,871,367,419,782,331,870,78,808,957,719,501,913,782,947,976,176,846,214,994,152,70,873,131,186,557,182,602,325,303,72,146,119,193,518,30,982,879,679,191,498,950,994,955,773,943,900,885,701,767,894,447,717,324,328,603,435,72,227,918,636,968,870,954,119,274,52,719,101,328,312,897,669,360,724,116,507,639,63,252,2,934,595,965,371,305,90,4,469,713,941,710,329,27,169,23,572,612,377,538,348,458,32,737,907,485,697,973,719,736,194,148,863,353,960,448,512,926,49,986,995,411,219,417,784,863,296,545,718,545,584,24,28,420,698,486,264,296,973,592,329,31,576,52,709,556,175,216,246,681,304,842,649,72,457,762,127,176,789,655,667,119,165,713,468,738,570,991,699,849,766,876,895,773,574,642,754,716,419,831,427,592,20,403,638,77,72}) << endl; // 367868228
}
